<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DX-Ball Clone</title>
<style>
  body {
    margin: 0;
    font-family: 'Press Start 2P', cursive;
    background: #111;
    color: #0f0;
    text-align: center;
  }
  .page {
    display: none;
    padding: 20px;
  }
  #startPage, #endPage {
    display: block;
  }
  button {
    padding: 10px 20px;
    margin-top: 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    background: #0f0;
    color: #111;
    cursor: pointer;
  }
  button:hover { background: #6f6; }
  canvas {
    display: block;
    margin: 0 auto;
    background: #000;
    border: 2px solid #0f0;
    border-radius: 10px;
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>

<!-- Start Page -->
<div id="startPage" class="page">
  <h1>DX-Ball Clone</h1>
  <p><strong>Objective:</strong> Destroy all the bricks!</p>
  <p><strong>Controls:</strong> Drag on mobile üì± or use ‚¨ÖÔ∏è ‚û°Ô∏è keys on desktop üíª.</p>
  <p><strong>Power-ups:</strong> Some help, some hurt. Collect wisely!</p>
  <p><strong>Levels:</strong> Progress through 10 levels to win üéØ</p>
  <button onclick="startGame()">Start Game</button>
</div>

<!-- Game Page -->
<div id="gamePage" class="page">
  <div id="hud">
    <span id="score">Score: 0</span> | 
    <span id="lives">Lives: 3</span> | 
    <span id="level">Level: 1</span>
  </div>
  <canvas id="gameCanvas"></canvas>
</div>

<!-- End Page (Game Over) -->
<div id="endPage" class="page">
  <h2>Game Over</h2>
  <p id="finalScore"></p>
  <button onclick="goToStart()">Back to Start</button>
</div>

<!-- Victory Page -->
<div id="victoryPage" class="page">
  <h2>üéâ Victory! üéâ</h2>
  <p id="victoryScore"></p>
  <button onclick="goToStart()">Play Again</button>
</div>

<script>
const startPage = document.getElementById("startPage");
const gamePage = document.getElementById("gamePage");
const endPage = document.getElementById("endPage");
const victoryPage = document.getElementById("victoryPage");

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let score = 0, lives = 3, level = 1;
const MAX_LEVEL = 10;
let paddle, ball, bricks = [], powerUps = [];

// üéµ Sounds
const sounds = {
  paddle: new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"),
  brick: new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"),
  power: new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg"),
  lose: new Audio("https://actions.google.com/sounds/v1/cartoon/metal_clang.ogg"),
  gameover: new Audio("https://actions.google.com/sounds/v1/cartoon/descending_whistle.ogg"),
  victory: new Audio("https://actions.google.com/sounds/v1/cartoon/slide_whistle.ogg")
};

// ===== Responsive Canvas =====
function resizeCanvas() {
  canvas.width = window.innerWidth * 0.9;
  canvas.height = window.innerHeight * 0.7;
}
window.addEventListener("resize", resizeCanvas);

// ===== Game Elements =====
function initGameObjects() {
  paddle = {
    width: canvas.width * 0.15,
    height: canvas.height * 0.03,
    x: canvas.width / 2 - (canvas.width * 0.15) / 2,
    y: canvas.height - canvas.height * 0.05,
    speed: canvas.width * 0.02
  };
  ball = {
    x: canvas.width / 2,
    y: canvas.height - canvas.height * 0.1,
    size: canvas.width * 0.015,
    dx: canvas.width * 0.005,
    dy: -canvas.width * 0.005
  };
  createBricks();
}

function createBricks() {
  bricks = [];
  const rows = 3 + level; // more rows each level
  const cols = 7;
  const brickWidth = canvas.width / (cols + 2);
  const brickHeight = canvas.height * 0.04;
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      bricks.push({
        x: c * (brickWidth + 5) + brickWidth,
        y: r * (brickHeight + 5) + brickHeight,
        width: brickWidth,
        height: brickHeight,
        broken: false
      });
    }
  }
}

// ===== PowerUps =====
function spawnPowerUp(x, y) {
  const types = ["bigPaddle", "smallPaddle", "extraLife", "loseLife"];
  const type = types[Math.floor(Math.random() * types.length)];
  powerUps.push({x, y, size: 20, dy: 2, type});
}

function drawPowerUps() {
  powerUps.forEach((p, i) => {
    ctx.fillStyle = (p.type === "bigPaddle" || p.type === "extraLife") ? "lime" : "red";
    ctx.fillRect(p.x, p.y, p.size, p.size);
    p.y += p.dy;
    // collision with paddle
    if (p.y + p.size >= paddle.y &&
        p.x + p.size >= paddle.x &&
        p.x <= paddle.x + paddle.width) {
      if (p.type === "bigPaddle") paddle.width *= 1.3;
      if (p.type === "smallPaddle") paddle.width *= 0.7;
      if (p.type === "extraLife") lives++;
      if (p.type === "loseLife") lives--;
      sounds.power.play();
      powerUps.splice(i, 1);
    }
  });
}

// ===== Game Loop =====
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // draw paddle
  ctx.fillStyle = "lime";
  ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);

  // draw ball
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.size, 0, Math.PI*2);
  ctx.fillStyle = "red";
  ctx.fill();
  ctx.closePath();

  // draw bricks
  bricks.forEach(b => {
    if (!b.broken) {
      ctx.fillStyle = "cyan";
      ctx.fillRect(b.x, b.y, b.width, b.height);
    }
  });

  drawPowerUps();

  // move ball
  ball.x += ball.dx;
  ball.y += ball.dy;

  // bounce walls
  if (ball.x - ball.size < 0 || ball.x + ball.size > canvas.width) {
    ball.dx *= -1;
    sounds.paddle.play();
  }
  if (ball.y - ball.size < 0) {
    ball.dy *= -1;
    sounds.paddle.play();
  }

  // paddle collision
  if (ball.y + ball.size >= paddle.y &&
      ball.x >= paddle.x && ball.x <= paddle.x + paddle.width) {
    ball.dy *= -1;
    sounds.paddle.play();
  }

  // brick collision
  bricks.forEach(b => {
    if (!b.broken &&
        ball.x >= b.x && ball.x <= b.x + b.width &&
        ball.y - ball.size <= b.y + b.height && ball.y + ball.size >= b.y) {
      ball.dy *= -1;
      b.broken = true;
      score += 10;
      sounds.brick.play();
      if (Math.random() < 0.3) spawnPowerUp(b.x + b.width/2, b.y); // 30% chance
    }
  });

  // lose life
  if (ball.y - ball.size > canvas.height) {
    lives--;
    sounds.lose.play();
    resetBall();
  }

  // level cleared
  if (bricks.every(b => b.broken)) {
    if (level === MAX_LEVEL) {
      victoryGame();
      return;
    }
    level++;
    createBricks();
    resetBall();
  }

  // update HUD
  document.getElementById("score").textContent = "Score: " + score;
  document.getElementById("lives").textContent = "Lives: " + lives;
  document.getElementById("level").textContent = "Level: " + level;

  // game over
  if (lives <= 0) {
    endGame();
    return;
  }

  requestAnimationFrame(draw);
}

function resetBall() {
  ball.x = canvas.width / 2;
  ball.y = canvas.height - canvas.height * 0.1;
  ball.dx = canvas.width * 0.005 * (Math.random() > 0.5 ? 1 : -1);
  ball.dy = -canvas.width * 0.005;
}

// ===== Controls =====
// Keyboard
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") paddle.x -= paddle.speed;
  if (e.key === "ArrowRight") paddle.x += paddle.speed;
});

// Touch (drag)
canvas.addEventListener("touchmove", e => {
  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  const touchX = touch.clientX - rect.left;
  paddle.x = touchX - paddle.width / 2;
  if (paddle.x < 0) paddle.x = 0;
  if (paddle.x + paddle.width > canvas.width) paddle.x = canvas.width - paddle.width;
});

// ===== Page Navigation =====
function startGame() {
  startPage.style.display = "none";
  endPage.style.display = "none";
  victoryPage.style.display = "none";
  gamePage.style.display = "block";
  score = 0; lives = 3; level = 1;
  resizeCanvas();
  initGameObjects();
  draw();
}
function endGame() {
  gamePage.style.display = "none";
  endPage.style.display = "block";
  document.getElementById("finalScore").textContent =
    `Final Score: ${score} | Level Reached: ${level}`;
  sounds.gameover.play();
}
function victoryGame() {
  gamePage.style.display = "none";
  victoryPage.style.display = "block";
  document.getElementById("victoryScore").textContent =
    `You Won! Final Score: ${score} | Level: ${level}`;
  sounds.victory.play();
}
function goToStart() {
  endPage.style.display = "none";
  victoryPage.style.display = "none";
  startPage.style.display = "block";
}
</script>
</body>
</html>
